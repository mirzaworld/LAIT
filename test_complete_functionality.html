<!DOCTYPE html>
<html>
<head>
    <title>LAIT Complete Functionality Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { background: white; margin: 20px 0; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .loading { background: #fff3cd; border: 1px solid #ffeeba; color: #856404; }
        button { background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .metric { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; }
        .metric-value { font-size: 24px; font-weight: bold; color: #007bff; }
        .metric-label { font-size: 14px; color: #6c757d; margin-top: 5px; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; max-height: 200px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ LAIT Complete Functionality Test</h1>
        <p>Testing all key features of the Legal AI Intelligence platform.</p>
        
        <div class="test-section">
            <h2>üöÄ Quick Test All Features</h2>
            <button onclick="runAllTests()">Run All Tests</button>
            <button onclick="clearResults()">Clear Results</button>
            <div id="overview"></div>
        </div>

        <div class="test-section">
            <h2>üìä Dashboard Metrics</h2>
            <button onclick="testDashboard()">Test Dashboard</button>
            <div id="dashboard-results"></div>
            <div id="dashboard-metrics" class="grid" style="margin-top: 20px;"></div>
        </div>

        <div class="test-section">
            <h2>üìÅ Invoice Management</h2>
            <button onclick="testInvoices()">Test Invoices</button>
            <button onclick="testInvoiceUpload()">Test Upload</button>
            <div id="invoice-results"></div>
        </div>

        <div class="test-section">
            <h2>üè¢ Vendor Management</h2>
            <button onclick="testVendors()">Test Vendors</button>
            <div id="vendor-results"></div>
        </div>

        <div class="test-section">
            <h2>‚öñÔ∏è Legal Intelligence</h2>
            <button onclick="testLegalIntelligence()">Test Legal Features</button>
            <div id="legal-results"></div>
        </div>

        <div class="test-section">
            <h2>üìà Analytics</h2>
            <button onclick="testAnalytics()">Test Analytics</button>
            <div id="analytics-results"></div>
        </div>

        <div class="test-section">
            <h2>üéØ Frontend Integration</h2>
            <button onclick="testFrontend()">Test Frontend</button>
            <div id="frontend-results"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5003/api';
        const FRONTEND_BASE = 'http://localhost:5173';
        const AUTH_HEADER = 'Bearer mock-jwt-token-for-development';

        function addResult(containerId, title, data, isSuccess = true) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            
            let content = `<h4>${title}</h4>`;
            if (typeof data === 'object') {
                content += `<pre>${JSON.stringify(data, null, 2).substring(0, 500)}${JSON.stringify(data, null, 2).length > 500 ? '...' : ''}</pre>`;
            } else {
                content += `<p>${data}</p>`;
            }
            
            div.innerHTML = content;
            container.appendChild(div);
        }

        function clearResults() {
            const containers = ['dashboard-results', 'invoice-results', 'vendor-results', 'legal-results', 'analytics-results', 'frontend-results', 'overview'];
            containers.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = '';
            });
            document.getElementById('dashboard-metrics').innerHTML = '';
        }

        async function makeRequest(url, options = {}) {
            const defaultOptions = {
                headers: {
                    'Authorization': AUTH_HEADER,
                    'Content-Type': 'application/json',
                    ...options.headers
                }
            };
            
            const response = await fetch(url, { ...defaultOptions, ...options });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            return await response.json();
        }

        async function testDashboard() {
            try {
                addResult('dashboard-results', 'Testing Dashboard...', 'Loading...', true);
                
                const metrics = await makeRequest(`${API_BASE}/dashboard/metrics`);
                addResult('dashboard-results', '‚úÖ Dashboard Metrics', metrics);
                
                // Create visual metrics display
                const metricsContainer = document.getElementById('dashboard-metrics');
                metricsContainer.innerHTML = `
                    <div class="metric">
                        <div class="metric-value">$${metrics.total_spend?.toLocaleString() || '0'}</div>
                        <div class="metric-label">Total Spend</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${metrics.invoice_count || 0}</div>
                        <div class="metric-label">Invoices</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${metrics.vendor_count || 0}</div>
                        <div class="metric-label">Vendors</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value">${metrics.high_risk_invoices_count || 0}</div>
                        <div class="metric-label">High Risk</div>
                    </div>
                `;
                
            } catch (error) {
                addResult('dashboard-results', '‚ùå Dashboard Error', error.message, false);
            }
        }

        async function testInvoices() {
            try {
                const invoices = await makeRequest(`${API_BASE}/invoices`);
                addResult('invoice-results', '‚úÖ Invoices List', `Found ${invoices.length} invoices`);
                
                if (invoices.length > 0) {
                    addResult('invoice-results', 'üìã Sample Invoice', invoices[0]);
                }
            } catch (error) {
                addResult('invoice-results', '‚ùå Invoices Error', error.message, false);
            }
        }

        async function testInvoiceUpload() {
            try {
                // Create a simple test file
                const testContent = 'INVOICE\\nTest Vendor\\nAmount: $1000\\nDate: 2024-01-01';
                const blob = new Blob([testContent], { type: 'text/plain' });
                const formData = new FormData();
                formData.append('file', blob, 'test-invoice.txt');
                formData.append('vendor', 'Test Vendor');
                formData.append('amount', '1000');
                
                const response = await fetch(`${API_BASE}/upload-invoice`, {
                    method: 'POST',
                    headers: {
                        'Authorization': AUTH_HEADER
                    },
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`Upload failed: ${response.status} ${response.statusText}`);
                }
                
                const result = await response.json();
                addResult('invoice-results', '‚úÖ Invoice Upload', result);
                
            } catch (error) {
                addResult('invoice-results', '‚ùå Upload Error', error.message, false);
            }
        }

        async function testVendors() {
            try {
                const vendors = await makeRequest(`${API_BASE}/vendors`);
                addResult('vendor-results', '‚úÖ Vendors List', `Found ${vendors.length} vendors`);
                
                if (vendors.length > 0) {
                    addResult('vendor-results', 'üè¢ Sample Vendor', vendors[0]);
                }
            } catch (error) {
                addResult('vendor-results', '‚ùå Vendors Error', error.message, false);
            }
        }

        async function testLegalIntelligence() {
            try {
                // Test jurisdictions endpoint (this should work without special auth)
                const jurisdictions = await makeRequest(`${API_BASE}/legal-intelligence/jurisdictions`);
                addResult('legal-results', '‚úÖ Legal Jurisdictions', jurisdictions);
                
            } catch (error) {
                addResult('legal-results', '‚ùå Legal Intelligence Error', error.message, false);
            }
        }

        async function testAnalytics() {
            try {
                // Test various analytics endpoints
                const endpoints = [
                    'analytics/spend-trends',
                    'analytics/vendor-performance',
                    'analytics/budget-forecast'
                ];
                
                for (const endpoint of endpoints) {
                    try {
                        const data = await makeRequest(`${API_BASE}/${endpoint}`);
                        addResult('analytics-results', `‚úÖ ${endpoint}`, data);
                    } catch (error) {
                        addResult('analytics-results', `‚ö†Ô∏è ${endpoint}`, error.message, false);
                    }
                }
                
            } catch (error) {
                addResult('analytics-results', '‚ùå Analytics Error', error.message, false);
            }
        }

        async function testFrontend() {
            try {
                // Test if frontend is accessible
                const response = await fetch(FRONTEND_BASE);
                if (response.ok) {
                    addResult('frontend-results', '‚úÖ Frontend Accessible', 'Frontend is running and accessible');
                } else {
                    throw new Error(`Frontend returned ${response.status}`);
                }
                
                // Test frontend API proxy
                const metricsViaProxy = await makeRequest(`${FRONTEND_BASE}/api/dashboard/metrics`);
                addResult('frontend-results', '‚úÖ Frontend API Proxy', 'Proxy is working correctly');
                
            } catch (error) {
                addResult('frontend-results', '‚ùå Frontend Error', error.message, false);
            }
        }

        async function runAllTests() {
            clearResults();
            addResult('overview', 'Running Complete Test Suite...', 'This may take a few moments', true);
            
            const tests = [
                { name: 'Dashboard', fn: testDashboard },
                { name: 'Invoices', fn: testInvoices },
                { name: 'Upload', fn: testInvoiceUpload },
                { name: 'Vendors', fn: testVendors },
                { name: 'Legal Intelligence', fn: testLegalIntelligence },
                { name: 'Analytics', fn: testAnalytics },
                { name: 'Frontend', fn: testFrontend }
            ];
            
            let passed = 0;
            for (const test of tests) {
                try {
                    await test.fn();
                    passed++;
                } catch (error) {
                    console.error(`Test ${test.name} failed:`, error);
                }
            }
            
            const summary = `
                üéØ Test Summary: ${passed}/${tests.length} tests passed
                
                ${passed === tests.length ? 'üéâ All tests passed! The LAIT system is fully functional.' : 
                  `‚ö†Ô∏è ${tests.length - passed} test(s) failed. Check individual sections for details.`}
                
                System Status: ${passed >= 5 ? 'OPERATIONAL' : 'NEEDS ATTENTION'}
            `;
            
            addResult('overview', 'Test Results', summary, passed >= 5);
        }
    </script>
</body>
</html>
